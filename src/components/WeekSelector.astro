---
import type { Language } from '../i18n/translations';
import { t } from '../i18n/translations';

interface Week {
  id: string;
  label: string;
  labelEn: string;
  isCurrent: boolean;
  isPast: boolean;
}

interface Props {
  weeks: Week[];
  currentWeekId: string;
  lang: Language;
}

const { weeks, currentWeekId, lang } = Astro.props;
---

<div class="mb-8">
  <!-- Mobile: Dropdown -->
  <div class="sm:hidden">
    <label for="week-select" class="sr-only">{t(lang, 'calendar.selectWeek')}</label>
    <select 
      id="week-select"
      class="w-full bg-cinema-darker border border-cinema-gray rounded-lg px-4 py-3 text-cinema-text focus:border-cereyan-pink focus:outline-none focus:ring-1 focus:ring-cereyan-pink"
      onchange="window.location.href = this.value"
    >
      {weeks.map((week) => (
        <option 
          value={`?week=${week.id}`}
          selected={week.id === currentWeekId}
        >
          {lang === 'tr' ? week.label : week.labelEn}
          {week.isCurrent ? ` (${t(lang, 'calendar.thisWeek')})` : ''}
        </option>
      ))}
    </select>
  </div>

  <!-- Desktop: Horizontal tabs -->
  <div class="hidden sm:block overflow-x-auto scrollbar-hide">
    <div class="flex items-center gap-1 min-w-max pb-2">
        {weeks.map((week) => {
          const isSelected = week.id === currentWeekId;
          const isCurrent = week.isCurrent;
          
          // Determine the style classes
          let styleClasses = "relative px-4 py-2 text-sm font-medium rounded-lg transition-all whitespace-nowrap";
          
          if (isSelected) {
            // SELECTED: Solid pink background
            styleClasses += " bg-cereyan-pink text-cinema-black font-semibold";
          } else if (isCurrent) {
            // CURRENT (not selected): Pink border outline
            styleClasses += " ring-2 ring-cereyan-pink/60 text-cereyan-pink hover:bg-cereyan-pink/10";
          } else if (week.isPast) {
            // PAST: Dimmed
            styleClasses += " text-cinema-text-muted/50 hover:text-cinema-text-muted hover:bg-cinema-gray/30";
          } else {
            // FUTURE: Normal muted
            styleClasses += " text-cinema-text-muted hover:text-cinema-text hover:bg-cinema-gray/50";
          }
          
          return (
            <a href={`?week=${week.id}`} class={styleClasses}>
              {lang === 'tr' ? week.label : week.labelEn}
              {/* Pulsing dot ONLY for current week when NOT selected */}
              {isCurrent && !isSelected && (
                <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-cereyan-pink rounded-full animate-pulse ring-2 ring-cinema-black"></span>
              )}
            </a>
          );
        })}
    </div>
  </div>

  <!-- Navigation arrows for context -->
  <div class="hidden sm:flex items-center justify-between mt-3 px-1">
    <button 
      onclick="document.querySelector('.overflow-x-auto').scrollBy({left: -200, behavior: 'smooth'})"
      class="text-cinema-text-muted hover:text-cereyan-pink transition-colors"
      aria-label={t(lang, 'calendar.previousWeek')}
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    
    <span class="text-xs text-cinema-text-muted uppercase tracking-wider">
      {t(lang, 'calendar.selectWeek')}
    </span>
    
    <button 
      onclick="document.querySelector('.overflow-x-auto').scrollBy({left: 200, behavior: 'smooth'})"
      class="text-cinema-text-muted hover:text-cereyan-pink transition-colors"
      aria-label={t(lang, 'calendar.nextWeek')}
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</div>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
