---
/**
 * Language toggle component for switching between Turkish and English
 */
import type { Language } from '../i18n/translations';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const currentPath = Astro.url.pathname;

// Normalize path by removing trailing slash (except for root)
function normalizePath(path: string): string {
  if (path === '/' || path === '') return '/';
  return path.replace(/\/$/, '');
}

// Calculate paths for language switch
function getAlternatePath(targetLang: Language): string {
  const normalizedPath = normalizePath(currentPath);
  
  if (targetLang === 'tr') {
    // Going from EN to TR
    // Remove /en prefix first
    let pathWithoutPrefix = normalizedPath.replace(/^\/en/, '');
    if (pathWithoutPrefix === '' || pathWithoutPrefix === '/') {
      return '/';
    }
    
    // Handle week paths: /week/X -> /hafta/X
    if (pathWithoutPrefix.startsWith('/week/')) {
      return pathWithoutPrefix.replace('/week/', '/hafta/');
    }
    
    // Handle venues: /venues -> /mekanlar
    if (pathWithoutPrefix === '/venues') {
      return '/mekanlar';
    }
    
    return pathWithoutPrefix;
  } else {
    // Going from TR to EN
    if (normalizedPath.startsWith('/en')) {
      return normalizedPath;
    }
    
    // Handle week paths: /hafta/X -> /en/week/X
    if (normalizedPath.startsWith('/hafta/')) {
      return '/en' + normalizedPath.replace('/hafta/', '/week/');
    }
    
    // Handle venues: /mekanlar -> /en/venues
    if (normalizedPath === '/mekanlar') {
      return '/en/venues';
    }
    
    // Default: add /en prefix
    return `/en${normalizedPath === '/' ? '' : normalizedPath}`;
  }
}
---

<div class="flex items-center gap-1 text-sm">
  <a 
    href={getAlternatePath('tr')}
    class:list={[
      "px-2 py-1 rounded transition-colors",
      lang === 'tr' 
        ? "bg-cereyan-pink/20 text-cereyan-pink font-medium" 
        : "text-text-muted hover:text-text"
    ]}
  >
    TR
  </a>
  <span class="text-border">/</span>
  <a 
    href={getAlternatePath('en')}
    class:list={[
      "px-2 py-1 rounded transition-colors",
      lang === 'en' 
        ? "bg-cereyan-pink/20 text-cereyan-pink font-medium" 
        : "text-text-muted hover:text-text"
    ]}
  >
    EN
  </a>
</div>
