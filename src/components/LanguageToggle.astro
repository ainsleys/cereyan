---
/**
 * Language toggle component for switching between Turkish and English
 */
import type { Language } from '../i18n/translations';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const currentPath = Astro.url.pathname;

// Path mappings between languages (TR path -> EN path)
const pathMappings: Record<string, string> = {
  '/': '/',
  '/mekanlar': '/venues',
};

// Create reverse mapping (EN path -> TR path)
const reversePathMappings: Record<string, string> = {};
for (const [tr, en] of Object.entries(pathMappings)) {
  reversePathMappings[en] = tr;
}

// Normalize path by removing trailing slash (except for root)
function normalizePath(path: string): string {
  if (path === '/' || path === '') return '/';
  return path.replace(/\/$/, '');
}

// Calculate paths for language switch
function getAlternatePath(targetLang: Language): string {
  const normalizedPath = normalizePath(currentPath);
  
  if (targetLang === 'tr') {
    // Going from EN to TR
    // Remove /en prefix first
    let pathWithoutPrefix = normalizedPath.replace(/^\/en/, '');
    if (pathWithoutPrefix === '' || pathWithoutPrefix === '/') {
      pathWithoutPrefix = '/';
    }
    // Check if there's a mapping
    return reversePathMappings[pathWithoutPrefix] || pathWithoutPrefix;
  } else {
    // Going from TR to EN
    if (normalizedPath.startsWith('/en')) {
      return normalizedPath;
    }
    // Check if there's a mapping for this path
    const mappedPath = pathMappings[normalizedPath] || normalizedPath;
    return `/en${mappedPath === '/' ? '' : mappedPath}`;
  }
}
---

<div class="flex items-center gap-1 text-sm">
  <a 
    href={getAlternatePath('tr')}
    class:list={[
      "px-2 py-1 rounded transition-colors",
      lang === 'tr' 
        ? "bg-cereyan-pink/20 text-cereyan-pink font-medium" 
        : "text-text-muted hover:text-text"
    ]}
  >
    TR
  </a>
  <span class="text-border">/</span>
  <a 
    href={getAlternatePath('en')}
    class:list={[
      "px-2 py-1 rounded transition-colors",
      lang === 'en' 
        ? "bg-cereyan-pink/20 text-cereyan-pink font-medium" 
        : "text-text-muted hover:text-text"
    ]}
  >
    EN
  </a>
</div>
