---
import Layout from '../../layouts/Layout.astro';
import { t } from '../../i18n/translations';
import type { Venue } from '../../types';

import venuesData from '../../data/venues.json';

const lang = 'en';
const venues = (venuesData as Venue[]).filter(v => v.id !== 'various');

// Group venues by neighborhood
const venuesByNeighborhood = venues.reduce((acc, venue) => {
  const neighborhood = venue.neighborhood;
  if (!acc[neighborhood]) {
    acc[neighborhood] = [];
  }
  acc[neighborhood].push(venue);
  return acc;
}, {} as Record<string, Venue[]>);

const neighborhoods = Object.keys(venuesByNeighborhood).sort();
---

<Layout title={t(lang, 'venues.title')} lang={lang}>
  <div class="space-y-8">
    <!-- Page header -->
    <header class="mb-8">
      <h1 class="font-display font-bold text-2xl sm:text-3xl text-text mb-2">
        {t(lang, 'venues.title')}
      </h1>
      <p class="text-text-muted">
        {t(lang, 'venues.subtitle')}
      </p>
    </header>

    <!-- Neighborhood filter -->
    <div class="flex flex-wrap gap-2 max-w-2xl mb-6" id="neighborhood-filter">
      <button 
        class="neighborhood-btn active font-mono text-xs px-3 py-1.5 font-semibold transition-colors"
        data-neighborhood="all"
      >
        {t(lang, 'venues.allNeighborhoods')}
      </button>
      {neighborhoods.map(neighborhood => (
        <button 
          class="neighborhood-btn font-mono text-xs px-3 py-1.5 font-semibold transition-colors"
          data-neighborhood={neighborhood}
        >
          {neighborhood}
        </button>
      ))}
    </div>

    <!-- Venues by neighborhood -->
    {neighborhoods.map(neighborhood => (
      <section class="mb-10 neighborhood-section" data-neighborhood={neighborhood}>
        <h2 class="date-header mb-4">
          {neighborhood}
        </h2>
        
        <div class="grid gap-4 max-w-2xl">
          {venuesByNeighborhood[neighborhood].map((venue, index) => (
            <article 
              class="venue-card animate-fade-in"
              style={`animation-delay: ${index * 0.05}s`}
            >
              <h3 class="font-display font-semibold text-lg text-text mb-2">
                {venue.name}
              </h3>
              
              {venue.address && (
                <div class="flex items-start gap-2 text-sm text-text-muted mb-3">
                  <svg class="w-4 h-4 mt-0.5 shrink-0 text-cereyan-pink" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  <span>{venue.address}</span>
                </div>
              )}
              
              {venue.descriptionEn && (
                <p class="text-sm text-text-muted leading-relaxed">
                  {venue.descriptionEn}
                </p>
              )}
            </article>
          ))}
        </div>
      </section>
    ))}
  </div>
</Layout>

<style>
  .neighborhood-btn {
    background: #F3F4F6;
    color: #6B7280;
  }
  .neighborhood-btn:hover {
    background: #FDF2F8;
    color: #C74B9B;
  }
  .neighborhood-btn.active {
    background: #C74B9B;
    color: white;
  }
  .neighborhood-section.hidden {
    display: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('.neighborhood-btn');
    const sections = document.querySelectorAll('.neighborhood-section');
    
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const neighborhood = btn.getAttribute('data-neighborhood');
        
        // Update active button
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Show/hide sections
        sections.forEach(section => {
          if (neighborhood === 'all' || section.getAttribute('data-neighborhood') === neighborhood) {
            section.classList.remove('hidden');
          } else {
            section.classList.add('hidden');
          }
        });
      });
    });
  });
</script>


